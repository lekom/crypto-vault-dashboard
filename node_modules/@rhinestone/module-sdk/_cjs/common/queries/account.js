"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getInstalledModules = void 0;
const constants_1 = require("../../constants");
const query = `
    query ($smartAccount: String, $chainId: Int) {
       SmartAccount_ModuleQuery (where: { smartAccount: { _eq: $smartAccount }, isInstalled: { _eq: true }, chainId: { _eq: $chainId }}) {
        moduleAddress,
        moduleTypeId
      }
    }
  `;
const getInstalledModules = async ({ account, client, }) => {
    const variables = {
        smartAccount: account.address,
        chainId: await client.getChainId(),
    };
    const response = await fetch(constants_1.GLOBAL_CONSTANTS.INDEXER_URL, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            query,
            variables,
        }),
    });
    const responseBody = await response.json();
    if (response.ok) {
        return responseBody.data.SmartAccount_ModuleQuery.map((module) => module.module);
    }
    else {
        throw new Error(`Error: ${responseBody.errors
            .map((error) => error.message)
            .join(', ')}`);
    }
};
exports.getInstalledModules = getInstalledModules;
//# sourceMappingURL=account.js.map